`timescale 1ns/1ps

module tb_vga_pic_g();

  // -------- DUT inputs --------
  reg         vga_clk;
  reg         sys_rst_n;
  reg  [9:0]  pix_x;
  reg  [9:0]  pix_y;
  reg         btn_left;
  reg         btn_right;
  reg         btn_ok;
  reg         btn_back;

  // -------- DUT outputs --------
  wire [15:0] pix_data;
  wire        game_over;

  // -------- clock: 25MHz (period 40ns) --------
  initial begin
    vga_clk = 1'b0;
  end
  always #20 vga_clk = ~vga_clk;

  // -------- reset --------
  initial begin
    sys_rst_n = 1'b0;
    pix_x     = 10'd0;
    pix_y     = 10'd0;
    btn_left  = 1'b0;
    btn_right = 1'b0;
    btn_ok    = 1'b0;
    btn_back  = 1'b0;

    #200;
    sys_rst_n = 1'b1;
  end

  // -------- pixel scan (simple 640x480 active area) --------
  // 每个 clk 推进一个像素点：x 0..639，y 0..479
  always @(posedge vga_clk or negedge sys_rst_n) begin
    if (!sys_rst_n) begin
      pix_x <= 10'd0;
      pix_y <= 10'd0;
    end else begin
      if (pix_x == 10'd639) begin
        pix_x <= 10'd0;
        if (pix_y == 10'd479)
          pix_y <= 10'd0;
        else
          pix_y <= pix_y + 10'd1;
      end else begin
        pix_x <= pix_x + 10'd1;
      end
    end
  end

  // -------- button stimulus --------
  // btn_left/btn_right 为 1 表示按下（你的 vga_pic_g 里就是 if(btn_left)）
  initial begin
    wait(sys_rst_n == 1'b1);

    // 先跑一会儿
    #2_000_000;  // 2ms

    // 向左按一段时间
    btn_left = 1'b1;
    #6_000_000;  // 6ms
    btn_left = 1'b0;

    #2_000_000;

    // 向右按一段时间
    btn_right = 1'b1;
    #8_000_000;  // 8ms
    btn_right = 1'b0;

    #2_000_000;

    // 再来几次交替（更像人在玩）
    btn_left = 1'b1;  #5_000_000;  btn_left = 1'b0;
    #1_000_000;
    btn_right = 1'b1; #5_000_000;  btn_right = 1'b0;

    // 总仿真时长（自己按需要调大/调小）
    #150_000_000; // 150ms
    $finish;
  end

  // -------- waveform dump --------
  initial begin
    $dumpfile("tb_vga_pic_g.vcd");
    $dumpvars(0, tb_vga_pic_g);
  end

  // -------- monitor game_over rising edge --------
  reg game_over_d;
  always @(posedge vga_clk or negedge sys_rst_n) begin
    if (!sys_rst_n) begin
      game_over_d <= 1'b0;
    end else begin
      game_over_d <= game_over;
      if (!game_over_d && game_over) begin
        $display("[%0t ns] game_over asserted!", $time);
      end
    end
  end

  // -------- instantiate DUT --------
  vga_pic_g dut (
    .vga_clk   (vga_clk),
    .sys_rst_n (sys_rst_n),
    .pix_x     (pix_x),
    .pix_y     (pix_y),
    .btn_left  (btn_left),
    .btn_right (btn_right),
    .btn_ok    (btn_ok),
    .btn_back  (btn_back),
    .pix_data  (pix_data),
    .game_over (game_over)
  );

endmodule
